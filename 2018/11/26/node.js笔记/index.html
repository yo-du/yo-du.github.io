<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="探寻设计的尺度"><title>Node.js笔记 | 有度</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="header-limit"><div class="site-name"><h1 class="hidden">Node.js笔记</h1><a class="logo-brand" href="/." rel="home"><img class="logo nofancybox" src="/img/logo.svg" alt="yodu"></a></div><div id="nav-menu"><a href="/."><i class="fa null"> 首页</i></a><a href="/categories/设计/"><i class="fa null"> 设计</i></a><a href="/categories/编程/"><i class="fa null"> 编程</i></a><a href="/categories/随笔/"><i class="fa null"> 随笔</i></a><a href="/about/"><i class="fa null"> 关于</i></a></div></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Node.js笔记</h1><div class="post-meta">2018-11-26<span class="category"><a href="/categories/编程/">编程</a></span></div><div class="clear"><div class="toc-article" id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#语法"><span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js的特点"><span class="toc-text">Node.js的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行终端命令"><span class="toc-text">执行终端命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模块-☍-☍"><span class="toc-text">模块 ☍ ☍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模块方式详解-☍"><span class="toc-text">模块方式详解 ☍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm"><span class="toc-text">npm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#修改镜像源"><span class="toc-text">修改镜像源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装包"><span class="toc-text">安装包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新包"><span class="toc-text">更新包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#npm-命令-☍"><span class="toc-text">npm 命令  ☍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#npm的任务自动化"><span class="toc-text">npm的任务自动化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#遇到的错误"><span class="toc-text">遇到的错误</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用包"><span class="toc-text">常用包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fs-extra"><span class="toc-text">fs-extra</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片处理库"><span class="toc-text">图片处理库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#node-版本升级"><span class="toc-text">node 版本升级</span></a></li></ol></li></ol></div></div><div class="post-content"><p><img src="/-media/node.js笔记/190511-324933.png" alt="190511-324933"></p>
<p>Node.js是一个事件驱动I/O的服务端JavaScript环境，基于Google的V8引擎，在JavaScript语法的基础上，增加了一些操作系统、文件、网络和数据库的操作。</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><h3 id="Node-js的特点"><a href="#Node-js的特点" class="headerlink" title="Node.js的特点"></a>Node.js的特点</h3><p>异步I/O</p>
<p>事件和回调</p>
<p>单线程和子进程</p>
<p>跨平台</p>
<h3 id="执行终端命令"><a href="#执行终端命令" class="headerlink" title="执行终端命令"></a>执行终端命令</h3><h4 id="execSync"><a href="#execSync" class="headerlink" title="execSync"></a>execSync</h4><p>开启一个子进程来执行终端命令</p>
<p>详见<a href="https://javascript.ruanyifeng.com/nodejs/child-process.html" target="_blank" rel="noopener">Child Process模块</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const execSync = require(&quot;child_process&quot;).execSync</span><br><span class="line"></span><br><span class="line">// 命令行执行hexo生成和部署</span><br><span class="line">execSync(&apos;hexo clean &amp;&amp; hexo g -d&apos;, &#123;</span><br><span class="line">  cwd: hexoDir</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="spawn和exec-☍"><a href="#spawn和exec-☍" class="headerlink" title="spawn和exec ☍"></a>spawn和exec <a href="https://www.jianshu.com/p/b6ec65fbb6e1" target="_blank" rel="noopener">☍</a></h4><p>child_process.spaen会返回一个带有stdout和stderr流的对象，用于返回大量数据，是“异步中的异步”，意思是在子进程开始执行时，它就开始从一个流总将数据从子进程返回给Node。</p>
<p>child_process.exec方法会从子进程中返回一个完整的buffer。用于返回结果，是“同步中的异步”，意思是尽管exec是异步的，它一定要等到子进程运行结束以后然后一次性返回所有的buffer数据。</p>
<h2 id="模块-☍-☍"><a href="#模块-☍-☍" class="headerlink" title="模块 ☍ ☍"></a>模块 <a href="https://www.tangshuang.net/2882.html" target="_blank" rel="noopener">☍</a> <a href="https://www.zhihu.com/question/56820346/answer/150724784" target="_blank" rel="noopener">☍</a></h2><p>一个js文件就是一个模块。</p>
<p>模块的标准有三个方面，一是Node.js的CommonJS标准、二是用于浏览器的AMD标准，如requirejs、三是 ES6新定义的标准。前两者都是旧的标准，随着浏览器逐步支持ES6，未来应该是ES6一统天下。而目前则是过渡阶段，可以通过babel来支持ES6，为日后做准备。</p>
<p>下面是Nodejs和ES6的模块常用格式：</p>
<p>CommonJS标准(node.js)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.js文件模块</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="string">'Michael'</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  s: s,</span><br><span class="line">  greet: <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello, '</span> + name + <span class="string">'!'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js中引入hello.js模块</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">require</span>(<span class="string">'./hello'</span>)	<span class="comment">// 注意相对目录，只写名称会依次在内置模块、全局模块和当前模块下查找，可能出错</span></span><br><span class="line"><span class="keyword">let</span> s = b.s</span><br><span class="line">b.greet(s) <span class="comment">// Hello, Michael!</span></span><br></pre></td></tr></table></figure>
<p>ES6</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.js文件模块</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="string">'Michael'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  s,</span><br><span class="line">  greet(name) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello, '</span> + name + <span class="string">'!'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js中引入hello.js模块</span></span><br><span class="line"><span class="keyword">import</span> b <span class="keyword">from</span> <span class="string">'./hello'</span></span><br><span class="line"><span class="keyword">let</span> s = b.s</span><br><span class="line">b.greet(s) <span class="comment">// Hello, Michael!</span></span><br></pre></td></tr></table></figure>
<h3 id="模块方式详解-☍"><a href="#模块方式详解-☍" class="headerlink" title="模块方式详解 ☍"></a>模块方式详解 <a href="https://segmentfault.com/a/1190000010426778" target="_blank" rel="noopener">☍</a></h3><ul>
<li><code>require</code>、<code>module.exports / exports</code>: node.js的引入和导出方式</li>
<li><code>export / import</code> : 只有es6 支持的导出引入</li>
</ul>
<h4 id="exports和-module-exports（node-js）"><a href="#exports和-module-exports（node-js）" class="headerlink" title="exports和 module.exports（node.js）"></a>exports和 module.exports（node.js）</h4><p>exports是module.exports的内存地址的引用，他们之间的关系如下图，都指向一块{}内存区域。</p>
<p><img src="../../../../../../Mobile%20Documents/iCloud~com~coderforart~iOS~MWeb/Documents/%C2%B7MD%E7%AC%94%E8%AE%B0/-media/javascript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/bVRMVd.png" alt="clipboard.png"> </p>
<p>为了避免糊涂，尽量都用 <code>module.exports</code> 导出，然后用<code>require</code>导入。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//utils.js</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">100</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.exports); <span class="comment">//能打印出结果为：&#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(exports); <span class="comment">//能打印出结果为：&#123;&#125;</span></span><br><span class="line"></span><br><span class="line">exports.a = <span class="number">200</span>; <span class="comment">//这里帮 module.exports 把内容改成 &#123;a : 200&#125;</span></span><br><span class="line">exports = <span class="string">'指向其他内存区'</span>; <span class="comment">//这里exports指向其他内存区域</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//test.js中引入</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'/utils'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// 打印为 &#123;a : 200&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="export-和-export-default（es6）"><a href="#export-和-export-default（es6）" class="headerlink" title="export 和 export default（es6）"></a>export 和 export default（es6）</h4><ol>
<li>export与export default均可用于导出常量、函数、文件、模块等</li>
<li>在一个文件或模块中，export、import可以有多个，<strong>export default仅有一个</strong></li>
<li>通过export方式导出，在导入时要用<code>import {a} from ..</code>，export default则用<code>import a from ..</code></li>
<li>export能直接导出变量表达式，export default不行。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件testEs6Export.js</span></span><br><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//导出变量</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="string">'100'</span>;  </span><br><span class="line"></span><br><span class="line"> <span class="comment">//导出方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dogSay = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'wang wang'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//导出方法第二种</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">catSay</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'miao miao'</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123; catSay &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//export default导出</span></span><br><span class="line"><span class="keyword">const</span> m = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> m; </span><br><span class="line"><span class="comment">//export defult const m = 100;// 这里不能写这种格式。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件index.js</span></span><br><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; dogSay, catSay &#125; <span class="keyword">from</span> <span class="string">'./testEs6Export'</span>; <span class="comment">//导出了 export 方法 </span></span><br><span class="line"><span class="keyword">import</span> m <span class="keyword">from</span> <span class="string">'./testEs6Export'</span>;  <span class="comment">//导出了 export default </span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> testModule <span class="keyword">from</span> <span class="string">'./testEs6Export'</span>; <span class="comment">//as 集合成对象导出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  dogSay();</span><br><span class="line">  catSay();</span><br><span class="line">  <span class="built_in">console</span>.log(m);</span><br><span class="line">  testModule.dogSay();</span><br><span class="line">  <span class="built_in">console</span>.log(testModule.m); <span class="comment">// undefined , 因为  as 导出是 把 零散的 export 聚集在一起作为一个对象，而export default 是导出为 default属性。</span></span><br><span class="line">  <span class="built_in">console</span>.log(testModule.default); <span class="comment">// 100</span></span><br><span class="line">  res.send(<span class="string">'恭喜你，成功验证'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<h4 id="export-用法☍"><a href="#export-用法☍" class="headerlink" title="export 用法☍"></a>export 用法<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/export" target="_blank" rel="noopener">☍</a></h4><h5 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; name1, name2, …, nameN &#125;;</span><br><span class="line"><span class="keyword">export</span> &#123; variable1 <span class="keyword">as</span> name1, variable2 <span class="keyword">as</span> name2, …, nameN &#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> name1, name2, …, nameN; <span class="comment">// also var</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> name1 = …, name2 = …, …, nameN; <span class="comment">// also var, const</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">FunctionName</span>(<span class="params"></span>) </span>&#123;...&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassName</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> expression;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">…</span>) </span>&#123; … &#125; <span class="comment">// also class, function*</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">name1</span>(<span class="params">…</span>) </span>&#123; … &#125; <span class="comment">// also class, function*</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125; <span class="comment">// 导出多个接口</span></span><br><span class="line"><span class="keyword">export</span> &#123; name1 <span class="keyword">as</span> <span class="keyword">default</span>, … &#125;;</span><br><span class="line">                                </span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> …;	<span class="comment">//*符号尽可能少用，它实际上是使用所有export的接口，但是很有可能你的当前模块并不会用到所有接口，可能仅仅是一个，所以最好的建议是使用花括号，用一个加一个。</span></span><br><span class="line"><span class="keyword">export</span> &#123; name1, name2, …, nameN &#125; <span class="keyword">from</span> …;</span><br><span class="line"><span class="keyword">export</span> &#123; import1 <span class="keyword">as</span> name1, import2 <span class="keyword">as</span> name2, …, nameN &#125; <span class="keyword">from</span> …; <span class="comment">//as后是别名，解决模块间的同名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//nameN为导出的标识符（用来被其他脚本的 import 导入）</span></span><br></pre></td></tr></table></figure>
<p>可以使用任何名称导入默认导出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> k = <span class="number">12</span></span><br><span class="line"><span class="comment">//相当于起了一个系统默认的变量名default，所以一个文件内不能有多个export default。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="comment">//可以使用任何名称导入default的导出</span></span><br><span class="line"><span class="keyword">import</span> m <span class="keyword">from</span> <span class="string">"./a.js"</span></span><br><span class="line"><span class="keyword">import</span> n <span class="keyword">from</span> <span class="string">"./a.js"</span> </span><br><span class="line"><span class="built_in">console</span>.log(m,n)   <span class="comment">// 12,12</span></span><br></pre></td></tr></table></figure>
<h4 id="require与import-☍"><a href="#require与import-☍" class="headerlink" title="require与import ☍"></a>require与import <a href="http://imweb.io/topic/582293894067ce9726778be9" target="_blank" rel="noopener">☍</a></h4><p>require理论上可以运用在代码的任何地方，甚至不需要赋值给某个变量之后再使用</p>
<p>import则不同，它是编译时的（require是运行时的），它必须放在文件开头，而且使用格式也是确定的，不容置疑。它不会将整个模块运行后赋值给某个变量，而是只选择import的接口进行编译，这样在性能上比require好很多。</p>
<p>require是赋值过程，import是解构过程</p>
<h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><h3 id="修改镜像源"><a href="#修改镜像源" class="headerlink" title="修改镜像源"></a>修改镜像源</h3><p>npm 的 config 命令（永久）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br><span class="line">npm config set disturl https://npm.taobao.org/dist</span><br></pre></td></tr></table></figure>
<p>在终端通过下面的命令获取当前 npm 使用的源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br><span class="line">npm config get disturl</span><br></pre></td></tr></table></figure>
<p>恢复官方源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config delete registry</span><br><span class="line">npm config delete disturl</span><br></pre></td></tr></table></figure>
<h3 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h3><p>To add an entry to your <code>package.json</code>‘s <code>devDependencies</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install &lt;package_name&gt; --save-dev</span><br></pre></td></tr></table></figure>
<p>To add an entry to your <code>package.json</code>‘s <code>dependencies</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install &lt;package_name&gt; --save</span><br></pre></td></tr></table></figure>
<h3 id="更新包"><a href="#更新包" class="headerlink" title="更新包"></a>更新包</h3><p>更新所有全局包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update -g</span><br></pre></td></tr></table></figure>
<p>检查有更新的本地包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm outdated</span><br></pre></td></tr></table></figure>
<p>检查全局包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm -g outdated</span><br></pre></td></tr></table></figure>
<p>查看本地版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm ls electron -g</span><br></pre></td></tr></table></figure>
<p>查看服务器最新版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm view electron version</span><br></pre></td></tr></table></figure>
<h4 id="本地全部升级到最新版本"><a href="#本地全部升级到最新版本" class="headerlink" title="本地全部升级到最新版本"></a>本地全部升级到最新版本</h4><p>安装高效升级插件npm-check-updates，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g npm-check-updates</span><br></pre></td></tr></table></figure>
<p>列出最新的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm-check-updates</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncu</span><br></pre></td></tr></table></figure>
<p>全部升级：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncu -a</span><br></pre></td></tr></table></figure>
<p>将package.json 中的包版本号改为最新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncu -u</span><br></pre></td></tr></table></figure>
<h3 id="npm-命令-☍"><a href="#npm-命令-☍" class="headerlink" title="npm 命令  ☍"></a>npm 命令  <a href="https://blog.csdn.net/chszs/article/details/50986354" target="_blank" rel="noopener">☍</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">npm init </span><br><span class="line">运行构建新项目的向导</span><br><span class="line">npm install module_name </span><br><span class="line">在项目中安装一个模块</span><br><span class="line">npm install -g module_name </span><br><span class="line">全局方式安装一个模块</span><br><span class="line">npm install module_name –save </span><br><span class="line">在项目中安装一个模块，并把此模块添加到项目配置文件package.json中，作为项目依赖</span><br><span class="line">npm install module_name –save-dev </span><br><span class="line">在项目中安装一个模块，并把此模块添加到项目配置文件package.json中，作为项目开发依赖（devDependency）</span><br><span class="line">npm list </span><br><span class="line">列出项目中已安装的所有模块</span><br><span class="line">npm list -g </span><br><span class="line">列出系统中全局安装的所有模块</span><br><span class="line">npm remove module_name </span><br><span class="line">从项目中移除已安装的模块</span><br><span class="line">npm remove -g module_name </span><br><span class="line">从系统的全局安装中移除已安装的模块</span><br><span class="line">npm remove module_name –save </span><br><span class="line">从项目中移除已安装的模块，并从配置依赖中移除依赖关系</span><br><span class="line">npm remove module_name –save-dev </span><br><span class="line">从项目中移除已安装的模块，并从配置依赖中移除开发依赖（devDependency）关系</span><br><span class="line">npm update module_name </span><br><span class="line">更新指定的已安装模块的版本</span><br><span class="line">npm update -g module_name </span><br><span class="line">更新指定的全局安装模块的版本</span><br><span class="line">npm -v </span><br><span class="line">显示npm包管理器的当前版本</span><br><span class="line">npm adduser username </span><br><span class="line">在npmjs.org创建一个账户</span><br><span class="line">npm whoami </span><br><span class="line">显示你在npmjs.org上的账户详细信息</span><br><span class="line">npm publish</span><br></pre></td></tr></table></figure>
<h3 id="npm的任务自动化"><a href="#npm的任务自动化" class="headerlink" title="npm的任务自动化"></a>npm的任务自动化</h3><p>package.json中的scripts定义了一些任务，比如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "test": "node test.js",</span><br><span class="line">    "start": "node app.js",</span><br><span class="line">  	"clean": "mv ./node_modules/.[!.]* /Users/fwk/.Trash"  //.[!.]包含隐藏文件</span><br><span class="line">  	"clean": "rm -rf ./node_modules/*"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个配置这定义了三个任务脚本：启动start、测试test、清理clean。要执行脚本，分别使用命令：</p>
<p>这个配置这定义了三个任务脚本：启动start、测试test、清理clean。要执行脚本，分别使用命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run start</span><br><span class="line">npm run <span class="built_in">test</span></span><br><span class="line">npm run clean</span><br></pre></td></tr></table></figure>
<h3 id="遇到的错误"><a href="#遇到的错误" class="headerlink" title="遇到的错误"></a>遇到的错误</h3><h5 id="安装全局包出错，提示：checkPermissions-Missing-write-access-to-…"><a href="#安装全局包出错，提示：checkPermissions-Missing-write-access-to-…" class="headerlink" title="安装全局包出错，提示：checkPermissions Missing write access to …"></a>安装全局包出错，提示：checkPermissions Missing write access to …</h5><p>解决方法：</p>
<ul>
<li>Reinstall npm with a node version manager (recommended)</li>
<li>Manually change npm’s default directory</li>
</ul>
<p><a href="https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally" target="_blank" rel="noopener">https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally</a></p>
<p><a href="https://www.jianshu.com/p/31744aa44824" target="_blank" rel="noopener">https://www.jianshu.com/p/31744aa44824</a></p>
<h4 id="端口被占用"><a href="#端口被占用" class="headerlink" title="端口被占用"></a>端口被占用</h4><p>执行npm run dev 提示：events.js:183 throw er; // Unhandled ‘error’ event</p>
<h2 id="常用包"><a href="#常用包" class="headerlink" title="常用包"></a>常用包</h2><h3 id="fs-extra"><a href="#fs-extra" class="headerlink" title="fs-extra"></a>fs-extra</h3><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save fs-extra</span><br></pre></td></tr></table></figure>
<p>引入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs-extra&apos;)</span><br></pre></td></tr></table></figure>
<p>常用方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取目录中的所有文件，包括隐藏文件</span></span><br><span class="line"><span class="keyword">let</span> imgs = fs.readdirSync(imgDir)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除目录或文件</span></span><br><span class="line">fs.removeSync(hexoPostDir)</span><br><span class="line"></span><br><span class="line"><span class="comment">//复制文件或文件夹，可在复制时重名，参数1是源文件或目录路径，参数2是目标文件或目录路径，已存在同名文件时会强制覆盖。</span></span><br><span class="line">fs.copySync(imgPath, imgNewPath)</span><br></pre></td></tr></table></figure>
<h3 id="图片处理库"><a href="#图片处理库" class="headerlink" title="图片处理库"></a>图片处理库</h3><h4 id="image-size"><a href="#image-size" class="headerlink" title="image-size"></a><a href="https://github.com/image-size/image-size" target="_blank" rel="noopener">image-size</a></h4><p>获取图片尺寸的Node 模块，简单好用 ，支持格式：BMP、CUR、GIF、ICNS、ICO、JPEG、PNG、PSD、TIFF、WebP、SVG、DDS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install image-size --save</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const sizeOf = require(&apos;image-size&apos;)</span><br><span class="line">var dimensions = sizeOf(&apos;images/funny-cats.png&apos;)</span><br><span class="line">console.log(dimensions.width, dimensions.height)</span><br></pre></td></tr></table></figure>
<h4 id="jimp"><a href="#jimp" class="headerlink" title="jimp"></a><a href="https://www.npmjs.com/package/jimp" target="_blank" rel="noopener">jimp</a></h4><p>JavaScript 图片处理包，性能一般，用起来比较简单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Jimp.read(imgPath, (err, lenna) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  lenna</span><br><span class="line">    .resize(<span class="number">660</span>, Jimp.AUTO) <span class="comment">// resize</span></span><br><span class="line">    .write(imgNewPath) <span class="comment">// save</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="gm-☍-☍"><a href="#gm-☍-☍" class="headerlink" title="gm ☍ ☍"></a><a href="https://github.com/aheckmann/gm" target="_blank" rel="noopener">gm</a> <a href="http://imushan.com/2018/01/09/tools/GraphicsMagick%E7%AC%94%E8%AE%B0-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" target="_blank" rel="noopener">☍</a> <a href="https://juejin.im/entry/5aa2c21df265da23a334d40f" target="_blank" rel="noopener">☍</a></h4><p>GraphicsMagick 的 node 版本，强大的图片处理工具，性能不错。</p>
<p>在安装npm 包之前，需要先安装GraphicsMagick或ImageMagick<br>mac 安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install imagemagick</span><br><span class="line">brew install graphicsmagick</span><br></pre></td></tr></table></figure>
<p>在工程目录安装npm包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i gm --save</span><br></pre></td></tr></table></figure>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>缩放图片、叠加图片（可用于水印）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gm = <span class="built_in">require</span>(<span class="string">'gm'</span>)</span><br><span class="line">gm(<span class="string">'./srcimage.jpg'</span>)</span><br><span class="line">.resize(<span class="number">660</span>,<span class="string">'&gt;'</span>) <span class="comment">// 只处理宽度&gt;660的图片</span></span><br><span class="line">.noProfile() <span class="comment">//去处EXIF信息</span></span><br><span class="line">.composite(<span class="string">'./logo-wartermark.png'</span>)</span><br><span class="line">.gravity(<span class="string">'SouthEast'</span>).geometry(<span class="string">'-5-5'</span>) <span class="comment">//水印放在右下角、相对右下角偏移-5、-5</span></span><br><span class="line">.write(<span class="string">'./saveimage.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  !err?<span class="built_in">console</span>.log(imgName, <span class="string">'————gm done'</span>): <span class="built_in">console</span>.log(imgName,<span class="string">'err1'</span> ,err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>.resize(w, h, ‘&gt;’)  可以制定宽高，只缩放宽时可以不传高，最后一个参数用于控制缩放的方式和条件：</p>
<ul>
<li><code>%</code>（比例方式计算尺寸）</li>
<li><code>@</code>（结果要小于指定的面积）</li>
<li><code>^</code>（保持比例同时充满宽高尺寸）</li>
<li><code>!</code>（不保持比例）</li>
<li><code>&lt;</code>（只处理小于指定尺寸的图片）</li>
<li><code>&gt;</code> （只处理大于指定尺寸的图片）</li>
</ul>
<p>.gravity(）通过地理方位来控制叠加图片的位置，即上北下南左西右东：NorthWest, North, NorthEast, West, Center, East, SouthWest, South, SouthEast。</p>
<p>注意，gif图片缩放会产生错位，尝试加了 .coalesce() 也没解决。</p>
<p>水印二</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在resize后会无效</span></span><br><span class="line">gm(<span class="string">'./srcimage.jpg'</span>)</span><br><span class="line">  .draw(<span class="string">'image Over 460, 460, 140, 140 "./logo-wartermark.jpg"'</span>) <span class="comment">//参数 operator x0,y0 w,h filename</span></span><br></pre></td></tr></table></figure>
<h3 id="node-版本升级"><a href="#node-版本升级" class="headerlink" title="node 版本升级"></a>node 版本升级</h3><p>npm中有一个模块叫做“n”，专门用来管理node.js版本的。</p>
<p>更新到最新的稳定版只需要在命令行中打下如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -g n</span><br><span class="line">n stable</span><br></pre></td></tr></table></figure>
<p>如需最新版本则用<code>n latest</code>；</p>
<p>升级到指定版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n v10.2.0</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/Node-npm/">Node,npm</a></div><div class="post-nav"><a class="next" href="/2018/07/06/vue笔记/">vue笔记</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yodu.xyz"></form></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">有度.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></div></div></div><a id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>